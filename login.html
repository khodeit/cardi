<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <title>کارتی پی - خرید ویزا کارت مجازی آمریکا | پرداخت بین المللی</title>
    <link rel="icon" href="/assests/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assests/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assests/favicon-32x32.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assests/apple-touch-icon.png"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://kit.fontawesome.com/85879a8cdb.js"
      crossorigin="anonymous"
    ></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700;900&display=swap");

      body {
        font-family: "Vazirmatn", sans-serif;
        background: #0f172a;
        color: white;
        overflow: hidden;
      }

      /* افکت Mesh Gradient متحرک برای پس‌زمینه */
      .bg-glow {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(
            circle at 10% 20%,
            rgba(50, 130, 184, 0.15) 0%,
            transparent 40%
          ),
          radial-gradient(
            circle at 90% 80%,
            rgba(27, 38, 44, 0.2) 0%,
            transparent 40%
          );
        z-index: -1;
      }

      .glass {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .input-glass {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .input-glass:focus {
        background: rgba(255, 255, 255, 0.1);
        border-color: #3282b8;
        outline: none;
        box-shadow: 0 0 15px rgba(50, 130, 184, 0.3);
      }

      /* انیمیشن برای تغییر تب‌ها */
      .tab-active {
        background: #3282b8 !important;
        color: white !important;
        box-shadow: 0 4px 15px rgba(50, 130, 184, 0.4);
      }

      .input-error { border-color: #ef4444 !important; box-shadow: 0 0 15px rgba(239,68,68,0.2) !important; background: rgba(239,68,68,0.05) !important; }
      .input-success { border-color: #22c55e !important; box-shadow: 0 0 15px rgba(34,197,94,0.2) !important; background: rgba(34,197,94,0.05) !important; }
      .error-msg { color: #ef4444; font-size: 10px; padding-right: 4px; margin-top: 4px; display: none; }
      .error-msg.show { display: block; animation: fadeInDown 0.2s ease; }

      .form-step { transition: all 0.35s cubic-bezier(0.4,0,0.2,1); }
      .step-enter { animation: slideInRight 0.35s cubic-bezier(0.4,0,0.2,1); }

      .btn-ripple { position: relative; overflow: hidden; }
      .btn-ripple::after { content:''; position:absolute; width:0; height:0; background:rgba(255,255,255,0.2); border-radius:50%; top:50%; left:50%; transform:translate(-50%,-50%); transition:width 0.4s ease,height 0.4s ease,opacity 0.4s ease; opacity:1; }
      .btn-ripple:active::after { width:300px; height:300px; opacity:0; }

      .otp-input { background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); transition:all 0.3s ease; caret-color:#3282b8; }
      .otp-input:focus { background:rgba(50,130,184,0.1); border-color:#3282b8; outline:none; box-shadow:0 0 20px rgba(50,130,184,0.3); transform:scale(1.05); }
      .otp-input.filled { border-color:rgba(34,197,94,0.5); background:rgba(34,197,94,0.05); }

      .step-dot { width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,0.15); transition:all 0.3s ease; }
      .step-dot.active { background:#3282b8; width:24px; border-radius:4px; box-shadow:0 0 10px rgba(50,130,184,0.5); }

      @keyframes slideInRight { from{opacity:0;transform:translateX(30px)} to{opacity:1;transform:translateX(0)} }
      @keyframes fadeInDown { from{opacity:0;transform:translateY(-5px)} to{opacity:1;transform:translateY(0)} }
      @keyframes shake { 0%,100%{transform:translateX(0)} 20%{transform:translateX(-8px)} 40%{transform:translateX(8px)} 60%{transform:translateX(-5px)} 80%{transform:translateX(5px)} }
      .shake { animation: shake 0.4s ease; }

      .spinner { display:inline-block; width:18px; height:18px; border:2px solid rgba(255,255,255,0.3); border-top-color:white; border-radius:50%; animation:spin 0.7s linear infinite; }
      @keyframes spin { to{transform:rotate(360deg)} }

      .timer-ring { transform:rotate(-90deg); transform-origin:50% 50%; }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen p-6">
    <div class="bg-glow"></div>

    <div class="w-full max-w-md">
      <div class="text-center mb-8">
        <img
          src="assests/logo.png"
          alt="AniCards"
          class="mx-auto h-16 w-auto"
        />
      </div>

      <div class="glass rounded-[2.5rem] p-8 shadow-2xl">
        <div class="flex bg-white/5 rounded-2xl p-1 mb-8">
          <button
            id="loginTab"
            onclick="switchTab('login')"
            class="flex-1 py-3 rounded-xl text-sm font-bold transition-all duration-300 tab-active"
          >
            ورود
          </button>
          <button
            id="registerTab"
            onclick="switchTab('register')"
            class="flex-1 py-3 rounded-xl text-sm font-bold text-white/40 transition-all duration-300"
          >
            ثبت‌نام
          </button>
        </div>

        <!-- Step indicators -->
        <div class="flex items-center justify-center gap-2 mb-6" id="stepIndicator">
          <div class="step-dot active" id="dot1"></div>
          <div class="step-dot" id="dot2"></div>
        </div>

        <!-- STEP 1: Login Form -->
        <form id="loginForm" class="space-y-5 form-step">
          <div class="text-center mb-6">
            <h2 class="text-xl font-bold">خوش آمدید</h2>
            <p class="text-white/40 text-xs mt-1">شماره موبایل و رمز خود را وارد کنید</p>
          </div>

          <div class="space-y-4">
            <div>
              <div class="relative">
                <input id="login-phone" type="text" placeholder="شماره موبایل"
                  class="w-full input-glass rounded-xl px-5 py-4 pr-5 pl-12 text-sm"
                  dir="ltr" maxlength="11"
                  oninput="validatePhone(this, 'login-phone-err')"
                />
                <i class="fa-solid fa-mobile-screen-button absolute left-4 top-[1.1rem] opacity-50" style="color:white"></i>
                <i class="fa-solid fa-check absolute right-4 top-[1.1rem] text-green-400 hidden" id="login-phone-check"></i>
              </div>
              <p class="error-msg" id="login-phone-err">شماره موبایل باید ۱۱ رقم و با ۰۹ شروع شود</p>
            </div>

            <div>
              <div class="relative">
                <i class="fa-solid fa-lock absolute left-4 top-[1.1rem] opacity-50" style="color:white"></i>
                <input id="login-pass" type="password" placeholder="رمز عبور"
                  class="w-full input-glass rounded-xl px-5 py-4 pl-12 pr-12 text-sm"
                  dir="ltr"
                  oninput="validatePassword(this, 'login-pass-err')"
                />
                <button type="button" class="absolute right-4 top-[1.1rem] opacity-40 hover:opacity-100 transition-opacity"
                  onclick="togglePassword('login-pass', 'eye-login')">
                  <i id="eye-login" class="fa-solid fa-eye" style="color:white"></i>
                </button>
              </div>
              <p class="error-msg" id="login-pass-err">رمز عبور باید حداقل ۶ کاراکتر باشد</p>
            </div>
          </div>

          <div class="flex justify-between items-center text-[11px] px-1">
            <label class="flex items-center gap-2 cursor-pointer opacity-60 hover:opacity-100">
              <input type="checkbox" class="accent-[#3282B8]" /> مرا به خاطر بسپار
            </label>
            <a href="#" class="text-[#3282B8] hover:underline">فراموشی رمز عبور؟</a>
          </div>

          <button type="button" id="loginSubmitBtn"
            class="w-full bg-[#3282B8] hover:bg-[#1B6CA8] text-white py-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-900/20 mt-4 btn-ripple"
            onclick="submitLogin()">
            تایید و دریافت کد
          </button>
        </form>

        <!-- STEP 1: Register Form -->
        <form id="registerForm" class="space-y-5 hidden">
          <div class="text-center mb-6">
            <h2 class="text-xl font-bold">ایجاد حساب کاربری</h2>
            <p class="text-white/40 text-xs mt-1">برای شروع، اطلاعات خود را وارد کنید</p>
          </div>

          <div class="space-y-4">
            <div>
              <div class="relative">
                <input id="reg-phone" type="text" placeholder="شماره موبایل"
                  class="w-full input-glass rounded-xl px-5 py-4 pl-12 text-sm"
                  dir="ltr" maxlength="11"
                  oninput="validatePhone(this, 'reg-phone-err')"
                />
                <i class="fa-solid fa-mobile-screen-button absolute left-4 top-[1.1rem] opacity-50" style="color:white"></i>
              </div>
              <p class="error-msg" id="reg-phone-err">شماره موبایل باید ۱۱ رقم و با ۰۹ شروع شود</p>
            </div>

            <div>
              <div class="relative">
                <input id="reg-user" type="text" placeholder="نام کاربری"
                  class="w-full input-glass rounded-xl px-5 py-4 pl-12 text-sm"
                  dir="ltr"
                  oninput="validateUsername(this, 'reg-user-err')"
                />
                <i class="fa-solid fa-user absolute left-4 top-[1.1rem] opacity-50" style="color:white"></i>
              </div>
              <p class="error-msg" id="reg-user-err">نام کاربری باید حداقل ۳ کاراکتر و فقط حروف انگلیسی باشد</p>
            </div>
          </div>

          <p class="text-[10px] text-white/30 text-center leading-loose">
            با ثبت‌نام در آنی‌کارت، <a href="#" class="text-[#3282B8]">قوانین و مقررات</a> سرویس را می‌پذیرم.
          </p>

          <button type="button"
            class="w-full bg-[#3282B8] hover:bg-[#1B6CA8] text-white py-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-900/20 mt-4 btn-ripple"
            onclick="submitRegister()">
            تایید و دریافت کد
          </button>
        </form>

        <!-- STEP 2: OTP Form (shared for both login & register) -->
        <form id="otpForm" class="space-y-6 hidden form-step">
          <div class="text-center mb-2">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-[#3282B8]/10 text-[#3282B8] text-2xl mb-4">
              <i class="fa-solid fa-comment-sms" style="color:white"></i>
            </div>
            <h2 class="text-xl font-bold">تایید شماره موبایل</h2>
            <p class="text-white/40 text-[11px] mt-2 leading-relaxed">
              کد تایید ۵ رقمی به شماره <span id="otpPhoneDisplay" class="text-[#BBE1FA] font-mono dir-ltr inline-block"></span> ارسال شد.
            </p>
          </div>

          <div class="flex justify-center gap-3 dir-ltr" id="otp-container">
            <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-xl font-black rounded-xl" />
            <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-xl font-black rounded-xl" />
            <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-xl font-black rounded-xl" />
            <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-xl font-black rounded-xl" />
            <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-xl font-black rounded-xl" />
          </div>
          <p class="error-msg text-center" id="otp-err" style="display:none">کد وارد شده صحیح نیست</p>

          <div class="space-y-4">
            <button type="button" id="verifyOtpBtn"
              class="w-full bg-[#3282B8] hover:bg-[#1B6CA8] text-white py-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-900/20 btn-ripple"
              onclick="verifyOtp()">
              تایید و ادامه
            </button>

            <div class="text-center">
              <div class="flex items-center justify-center gap-3">
                <svg width="36" height="36" viewBox="0 0 36 36" class="timer-ring">
                  <circle cx="18" cy="18" r="15" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="2.5"/>
                  <circle id="timerCircle" cx="18" cy="18" r="15" fill="none" stroke="#3282B8" stroke-width="2.5"
                    stroke-dasharray="94.2" stroke-dashoffset="0" stroke-linecap="round"/>
                </svg>
                <p id="timerText" class="text-[11px] text-white/30">
                  ارسال مجدد کد تا <span id="timerCountdown" class="text-white font-mono">02:00</span>
                </p>
              </div>
              <button id="resendBtn" type="button"
                class="hidden text-[11px] text-[#3282B8] font-bold hover:underline mt-2"
                onclick="resendCode()">
                ارسال مجدد کد تایید
              </button>
            </div>
          </div>

          <button type="button" onclick="goBackFromOtp()"
            class="w-full text-white/30 hover:text-white text-xs transition-colors py-2">
            ← بازگشت و ویرایش شماره
          </button>
        </form>
      </div>

      <div class="text-center mt-8">
        <a
          href="index.html"
          class="text-white/30 hover:text-white text-xs transition-colors"
          >← بازگشت به صفحه اصلی</a
        >
      </div>
    </div>


    <script>
      let currentTab = 'login';
      let otpTimer = null;
      let timeLeft = 120;

      function switchTab(type) {
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const otpForm = document.getElementById("otpForm");
        const loginTab = document.getElementById("loginTab");
        const registerTab = document.getElementById("registerTab");

        currentTab = type;
        otpForm.classList.add("hidden");
        setStep(1);

        if (type === "login") {
          loginForm.classList.remove("hidden");
          registerForm.classList.add("hidden");
          loginTab.classList.add("tab-active");
          registerTab.classList.remove("tab-active");
          registerTab.classList.add("text-white/40");
        } else {
          loginForm.classList.add("hidden");
          registerForm.classList.remove("hidden");
          registerTab.classList.add("tab-active");
          loginTab.classList.remove("tab-active");
          loginTab.classList.add("text-white/40");
        }
      }

      // --- Validation ---
      function validatePhone(input, errId) {
        const val = input.value.replace(/\D/g, '');
        input.value = val;
        const valid = /^09\d{9}$/.test(val);
        const err = document.getElementById(errId);
        if (val.length === 0) {
          input.classList.remove('input-error', 'input-success');
          err.classList.remove('show');
        } else if (valid) {
          input.classList.add('input-success'); input.classList.remove('input-error');
          err.classList.remove('show');
          const chk = document.getElementById('login-phone-check');
          if (chk) chk.classList.remove('hidden');
        } else {
          input.classList.add('input-error'); input.classList.remove('input-success');
          err.classList.add('show');
          const chk = document.getElementById('login-phone-check');
          if (chk) chk.classList.add('hidden');
        }
        return valid;
      }

      function validatePassword(input, errId) {
        const valid = input.value.length >= 6;
        const err = document.getElementById(errId);
        if (input.value.length === 0) {
          input.classList.remove('input-error', 'input-success');
          err.classList.remove('show');
        } else if (valid) {
          input.classList.add('input-success'); input.classList.remove('input-error');
          err.classList.remove('show');
        } else {
          input.classList.add('input-error'); input.classList.remove('input-success');
          err.classList.add('show');
        }
        return valid;
      }

      function validateUsername(input, errId) {
        const valid = /^[a-zA-Z0-9_]{3,}$/.test(input.value);
        const err = document.getElementById(errId);
        if (input.value.length === 0) {
          input.classList.remove('input-error', 'input-success');
          err.classList.remove('show');
        } else if (valid) {
          input.classList.add('input-success'); input.classList.remove('input-error');
          err.classList.remove('show');
        } else {
          input.classList.add('input-error'); input.classList.remove('input-success');
          err.classList.add('show');
        }
        return valid;
      }

      function togglePassword(inputId, iconId) {
        const inp = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        if (inp.type === 'password') {
          inp.type = 'text';
          icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
          inp.type = 'password';
          icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
      }

      // --- Step management ---
      function setStep(n) {
        const dot1 = document.getElementById('dot1');
        const dot2 = document.getElementById('dot2');
        if (n === 1) { dot1.classList.add('active'); dot2.classList.remove('active'); }
        else { dot2.classList.add('active'); dot1.classList.remove('active'); }
      }

      function showOtpStep(phone) {
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const otpForm = document.getElementById("otpForm");

        loginForm.classList.add("hidden");
        registerForm.classList.add("hidden");

        document.getElementById('otpPhoneDisplay').textContent = phone;
        otpForm.classList.remove("hidden");
        otpForm.classList.add("step-enter");
        setTimeout(() => otpForm.classList.remove("step-enter"), 400);

        setStep(2);
        startTimer();

        // focus first otp input
        setTimeout(() => {
          document.querySelector('#otp-container input').focus();
        }, 400);
      }

      function goBackFromOtp() {
        clearInterval(otpTimer);
        const otpForm = document.getElementById("otpForm");
        otpForm.classList.add("hidden");
        setStep(1);
        if (currentTab === 'login') {
          document.getElementById("loginForm").classList.remove("hidden");
        } else {
          document.getElementById("registerForm").classList.remove("hidden");
        }
        // clear otp inputs
        document.querySelectorAll('#otp-container input').forEach(i => {
          i.value = ''; i.classList.remove('filled', 'input-error', 'input-success');
        });
      }

      // --- Submit handlers ---
      function submitLogin() {
        const phone = document.getElementById('login-phone');
        const pass = document.getElementById('login-pass');
        const btn = document.getElementById('loginSubmitBtn');

        const phoneOk = validatePhone(phone, 'login-phone-err');
        const passOk = validatePassword(pass, 'login-pass-err');

        if (!phoneOk || !passOk) {
          btn.classList.add('shake');
          setTimeout(() => btn.classList.remove('shake'), 400);
          return;
        }

        // loading state
        btn.innerHTML = '<span class="spinner"></span>';
        btn.disabled = true;

        setTimeout(() => {
          btn.innerHTML = 'تایید و دریافت کد';
          btn.disabled = false;
          showOtpStep(phone.value);
        }, 1200);
      }

      function submitRegister() {
        const phone = document.getElementById('reg-phone');
        const user = document.getElementById('reg-user');
        const btn = event.target;

        const phoneOk = validatePhone(phone, 'reg-phone-err');
        const userOk = validateUsername(user, 'reg-user-err');

        if (!phoneOk || !userOk) {
          btn.classList.add('shake');
          setTimeout(() => btn.classList.remove('shake'), 400);
          return;
        }

        btn.innerHTML = '<span class="spinner"></span>';
        btn.disabled = true;

        setTimeout(() => {
          btn.innerHTML = 'تایید و دریافت کد';
          btn.disabled = false;
          showOtpStep(phone.value);
        }, 1200);
      }

      function verifyOtp() {
        const inputs = document.querySelectorAll('#otp-container input');
        const code = Array.from(inputs).map(i => i.value).join('');
        const btn = document.getElementById('verifyOtpBtn');
        const errEl = document.getElementById('otp-err');

        if (code.length < 5) {
          inputs.forEach(i => { i.classList.add('input-error'); });
          errEl.classList.add('show');
          errEl.style.display = 'block';
          return;
        }

        btn.innerHTML = '<span class="spinner"></span>';
        btn.disabled = true;

        // Simulate verification — replace with real API call
        setTimeout(() => {
          // Fake: accept any 5-digit code
          if (code === '00000') {
            inputs.forEach(i => { i.classList.add('input-error'); i.classList.remove('filled'); });
            errEl.classList.add('show'); errEl.style.display = 'block';
            btn.innerHTML = 'تایید و ادامه';
            btn.disabled = false;
          } else {
            inputs.forEach(i => { i.classList.add('input-success'); i.classList.remove('input-error'); });
            btn.innerHTML = '<i class="fa-solid fa-check ml-2"></i> تایید شد!';
            btn.classList.replace('bg-[#3282B8]', 'bg-green-600');
            clearInterval(otpTimer);
            setTimeout(() => { window.location.href = 'dashboard.html'; }, 800);
          }
        }, 1000);
      }

      // --- OTP input navigation ---
      document.addEventListener('DOMContentLoaded', () => {
        const inputs = document.querySelectorAll("#otp-container input");
        inputs.forEach((input, index) => {
          input.addEventListener("input", (e) => {
            const val = e.target.value.replace(/\D/g, '');
            e.target.value = val;
            if (val) {
              input.classList.add('filled');
              if (index < inputs.length - 1) inputs[index + 1].focus();
            } else {
              input.classList.remove('filled');
            }
            // clear error on input
            document.getElementById('otp-err').style.display = 'none';
            inputs.forEach(i => i.classList.remove('input-error'));
          });
          input.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" && !e.target.value && index > 0) {
              inputs[index - 1].focus();
              inputs[index - 1].classList.remove('filled');
            }
          });
          input.addEventListener("paste", (e) => {
            e.preventDefault();
            const paste = e.clipboardData.getData('text').replace(/\D/g, '').slice(0, 5);
            paste.split('').forEach((char, i) => {
              if (inputs[i]) { inputs[i].value = char; inputs[i].classList.add('filled'); }
            });
            if (paste.length < 5 && inputs[paste.length]) inputs[paste.length].focus();
          });
        });
      });

      // --- Timer ---
      function startTimer() {
        clearInterval(otpTimer);
        timeLeft = 120;
        const circle = document.getElementById('timerCircle');
        const countdownEl = document.getElementById('timerCountdown');
        const timerText = document.getElementById('timerText');
        const resendBtn = document.getElementById('resendBtn');
        const circumference = 94.2;

        resendBtn.classList.add('hidden');
        timerText.classList.remove('hidden');

        otpTimer = setInterval(() => {
          timeLeft--;
          const mins = Math.floor(timeLeft / 60);
          const secs = timeLeft % 60;
          countdownEl.textContent = `0${mins}:${secs < 10 ? '0' + secs : secs}`;
          // ring progress
          const offset = circumference * (1 - timeLeft / 120);
          circle.style.strokeDashoffset = offset;

          if (timeLeft <= 0) {
            clearInterval(otpTimer);
            timerText.classList.add('hidden');
            resendBtn.classList.remove('hidden');
          }
        }, 1000);
      }

      function resendCode() {
        const resendBtn = document.getElementById('resendBtn');
        resendBtn.classList.add('hidden');
        document.getElementById('timerText').classList.remove('hidden');
        // clear otp
        document.querySelectorAll('#otp-container input').forEach(i => {
          i.value = ''; i.classList.remove('filled', 'input-error', 'input-success');
        });
        document.getElementById('otp-err').style.display = 'none';
        startTimer();
      }
    </script>
  </body>
</html>